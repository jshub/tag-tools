  <%= f.error_messages %>
  
  <fieldset><h2>Data capture plugins</h2>

  <% # Required to capture when no plugins are selected %>
  <!-- <%= hidden_field_tag "tag_configuration[plugin_config][]", "" %> -->

  <p>
    <%= check_box_tag label_for_plugin_param(:microformat, :include), true,
          @tag_configuration.plugins.include?(mf_plugin) %>
    <%= label_tag label_for_plugin_param(:microformat, :include), 
          'Page data html microformats', :class => 'right plugin_name' %> <br />
	<small>Collects basic information about the page, from html microformat markup on the page.</small>
  </p>
  <p>
    <%= check_box_tag label_for_plugin_param(:google_analytics_markup, :include), true,
          @tag_configuration.plugins.include?(ga_markup_plugin) %>
    <%= label_tag label_for_plugin_param(:google_analytics_markup, :include), 
          'Google Analytics markup capture', :class => 'right plugin_name' %> <br />
	<small>
	  Collects basic basic page view information from existing Google Analytics tags on the
	  page. This plugin does <em>not</em> replace the Google tag, and does not require any
	  configuration.
	</small>
  </p>
  </fieldset>

  <hr />

  <fieldset><h2>Data transport plugins</h2>

  <p>
    <%= check_box_tag label_for_plugin_param(:causata, :include), true,
          @tag_configuration.plugins.include?(causata_plugin), 
          :class => 'configurable' %>
    <%= label_tag label_for_plugin_param(:causata, :include), "Causata",
          :class => 'right plugin_name' %> <br />
	<small>Sends information to the Causata server.</small>
  </p>
  <div id="configure_plugin_<%= causata_plugin.id %>">
    <p>
      <%= label_tag label_for_plugin_param(:causata, :server_url), 
            'Server URL' %>
      <%= text_field_tag label_for_plugin_param(:causata, :server_url), 
            value_for_plugin_param(:causata, :server_url) %>
      
    </p>
    <p>
      <%= label_tag label_for_plugin_param(:causata, :account_id), 
            'Account ID' %>
      <%= text_field_tag label_for_plugin_param(:causata, :account_id), 
            value_for_plugin_param(:causata, :account_id) %>
      
    </p>
  </div>
  
  <p>
    <%= check_box_tag label_for_plugin_param(:piwik, :include), true,
          @tag_configuration.plugins.include?(piwik_plugin), 
          :class => 'configurable' %>
    <%= label_tag label_for_plugin_param(:piwik, :include), "Piwik web analytics",
          :class => 'right plugin_name' %> <br />  	
	<small>Sends information to the Piwik web analytics service.</small>
  </p>
  
  <div id="configure_plugin_<%= piwik_plugin.id %>">
    <p>
      <%= label_tag label_for_plugin_param(:piwik, :server_url), 'Server URL' %>
      <%= text_field_tag label_for_plugin_param(:piwik, :server_url), 
            value_for_plugin_param(:piwik, :server_url) %>
      
    </p>
    <p>
      <%= label_tag label_for_plugin_param(:piwik, :account), 'Account ID' %>
      <%= text_field_tag label_for_plugin_param(:piwik, :account), 
            value_for_plugin_param(:piwik, :account) %>
      
    </p>
  </div>
  
  <script type="text/javascript">
    function bindConfig() {
      var checkbox = this, id = checkbox.id.match(/[0-9]+/), config_div = $('#configure_plugin_'+id);
      $(checkbox).bind("change", function(evt) {
        if (evt.target.checked) {
          config_div.show('medium');
        } else {
          config_div.hide('medium');
        }
      });
      if (! checkbox.checked) {
	  	config_div.hide();
	  }
    }
    
    $('input:checkbox.configurable').each(bindConfig);
  </script>

  </fieldset>

  <hr />
  
  <fieldset><h2>Comments</h2>
  
  <p>
    <%= f.text_area :site_name %>
  </p>
  <p class="hide">
    <%= f.label :jshub_version, 'jsHub code version:' %>
    <%= f.select :jshub_version, tag_versions, :size => 1 %>
  </p>
  
  </fieldset>

  <hr />  