<div class="login">
<% if @user == nil %>
  <% form_tag(:controller => 'users', :action => "login" ) do %>
  <%= hidden_field_tag "original_uri", request.request_uri %>
  <span class="login-state">Welcome.</span>
  <span class="message">Please <%= link_to("create an account", {:controller => 'users', :action => "register"}) %> or </span>
  <%= link_to 'log in', login_path %> to save your settings.
  <% end %>
<% else %>
  <% form_tag(:controller => 'users', :action => "logout" ) do %>
  <div>
    <%= hidden_field_tag "original_uri", request.request_uri %>
    <span class="login-state">Logged in as:</span>
    <span class="username"><%= @user.name %></span>
    <span class="account"><%= link_to 'Your account', @user %></span>
    | <%= link_to 'Log out', logout_path %>
  </div>
  <% end %>
<% end %>
</div>